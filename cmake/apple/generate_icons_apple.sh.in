#!/bin/bash

# Recolor icon
echo "Recoloring vector icon..."
case "$1" in
	"-r" ) # Release
	sed 's/#780116/#249a56/g; s/#c51306/#50d99b/g' ../branding/icon.svg > recolored-icon.svg
	sed 's/#780116/#249a56/g; s/#c51306/#50d99b/g' ../branding/splash.svg > recolored-splash.svg
	;;
	"-b" | "-rc" ) # Beta/Release Candidate
	sed 's/#780116/#0267c1/g; s/#c51306/#09a9d9/g' ../branding/icon.svg > recolored-icon.svg
	sed 's/#780116/#0267c1/g; s/#c51306/#09a9d9/g' ../branding/splash.svg > recolored-splash.svg
	;;
	"-c" | "-n" ) # Canary/Nightly
	sed 's/#780116/#ffa40f/g; s/#c51306/#fad200/g' ../branding/icon.svg > recolored-icon.svg
	sed 's/#780116/#ffa40f/g; s/#c51306/#fad200/g' ../branding/splash.svg > recolored-splash.svg
	;;
	* ) # No type specified, leave it be
	sed '' ../branding/icon.svg > recolored-icon.svg
	sed '' ../branding/splash.svg > recolored-splash.svg
	;;
esac

# Generate raster images
echo "Generating raster images for icon..."
mkdir lmms.iconset

for RES in 16 32 64 128 256 512
do
	rsvg-convert -w $RES -h $RES recolored-icon.svg -o "lmms.iconset/icon_${RES}x${RES}.png"
done

for RES in 16 32 64 128 256 512
do
	rsvg-convert -w $((RES * 2)) -h $((RES * 2)) recolored-icon.svg -o "lmms.iconset/icon_${RES}x${RES}@2x.png"
done

# Generate macOS .icns from .iconset
echo "Generating macOS .icns from raster images..."
iconutil -c icns -o icon.icns lmms.iconset

echo "Generating raster image for splash screen..."
rsvg-convert -w 680 -h 573 recolored-splash.svg -o ../../data/themes/default/splash.png

# Clean up images
echo "Cleaning up temporary images..."
rm -f recolored*.svg
rm -f icon_*.png
rm -r lmms.iconset
